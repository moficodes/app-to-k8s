<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Get It To Kubernetes Right | App to K8s</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Get It To Kubernetes Right | App to K8s"><meta data-react-helmet="true" name="description" content="You should already have the repo cloned from the setup step."><meta data-react-helmet="true" property="og:description" content="You should already have the repo cloned from the setup step."><meta data-react-helmet="true" property="og:url" content="https://moficodes.github.com/app-to-k8s/docs/get-it-to-kubernetes-right"><link data-react-helmet="true" rel="shortcut icon" href="/app-to-k8s/img/k8s-icon.png"><link data-react-helmet="true" rel="canonical" href="https://moficodes.github.com/app-to-k8s/docs/get-it-to-kubernetes-right"><link rel="stylesheet" href="/app-to-k8s/styles.4b5091be.css">
<link rel="preload" href="/app-to-k8s/styles.c766f05e.js" as="script">
<link rel="preload" href="/app-to-k8s/runtime~main.c7034982.js" as="script">
<link rel="preload" href="/app-to-k8s/main.7f4e0a46.js" as="script">
<link rel="preload" href="/app-to-k8s/1.6629a8c1.js" as="script">
<link rel="preload" href="/app-to-k8s/2.011edda5.js" as="script">
<link rel="preload" href="/app-to-k8s/36.45b256d1.js" as="script">
<link rel="preload" href="/app-to-k8s/37.dbbad70c.js" as="script">
<link rel="preload" href="/app-to-k8s/a1694d8d.506d67fe.js" as="script">
<link rel="preload" href="/app-to-k8s/17896441.18b63303.js" as="script">
<link rel="preload" href="/app-to-k8s/0b8842b4.0d17634d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/app-to-k8s/"><img class="navbar__logo" src="/app-to-k8s/img/k8s-icon.png" alt="Kubernetes logo"><strong class="navbar__title">Kubernetes</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/app-to-k8s/docs/">Docs</a><a href="https://twitter.com/moficodes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">@moficodes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/moficodes/app-to-k8s" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/app-to-k8s/"><img class="navbar__logo" src="/app-to-k8s/img/k8s-icon.png" alt="Kubernetes logo"><strong class="navbar__title">Kubernetes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/app-to-k8s/docs/">Docs</a></li><li class="menu__list-item"><a href="https://twitter.com/moficodes" target="_blank" rel="noopener noreferrer" class="menu__link">@moficodes</a></li><li class="menu__list-item"><a href="https://github.com/moficodes/app-to-k8s" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/app-to-k8s/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/app-to-k8s/docs/setup">Setup</a></li><li class="menu__list-item"><a class="menu__link" href="/app-to-k8s/docs/shallow-dive">Kubernetes Shallow Dive</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Workshop</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-to-k8s/docs/workshop-intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-to-k8s/docs/the-application">The Application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-to-k8s/docs/containerize">Containerize</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-to-k8s/docs/get-it-to-kubernetes">Get It To Kubernetes</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/app-to-k8s/docs/get-it-to-kubernetes-right">Get It To Kubernetes Right</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-to-k8s/docs/kubernetes-best-practices">Kubernetes Best Practices</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/app-to-k8s/docs/next-steps">Next Steps</a></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Get It To Kubernetes Right</h1></header><div class="markdown"><p>You should already have the repo cloned from the setup step.</p><p>Incase you dont</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/moficodes/app-to-k8s.git</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd app-to-k8s/k8s/all-deployment-svc/</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f .</span></div></div></div></div></div><p>Go back to the root of the folder.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd ../..</span></div></div></div></div></div><p>You should an output like</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/factorial-service created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/fact-deploy created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/fib-service created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/fib-deploy created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/prime-service created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/prime-deploy created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/ui-service created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/foxfram-ui created</span></div></div></div></div></div><p>Whoa! alot of thing happened pretty fast. </p><p>Lets take a step back a look at each of the parts individually.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cat foxfram-fib-v1-deployment.yaml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: apps/v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Deployment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name:  fib-deploy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  namespace: default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    app: fib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    version: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  replicas: 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    matchLabels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: fib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  strategy:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    rollingUpdate:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      maxSurge: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      maxUnavailable: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type: RollingUpdate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  template:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        app: fib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        version: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      containers:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - image:  moficodes/foxfram-fib:0.0.5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name:  fib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        imagePullPolicy: Always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        resources:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          requests:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            cpu: &quot;250m&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            memory: &quot;128Mi&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          limits:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            cpu: &quot;250m&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            memory: &quot;128Mi&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        livenessProbe:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          httpGet:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            path: /health</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            port: 8080</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          initialDelaySeconds: 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          periodSeconds: 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - containerPort:  8080</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name: http</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      restartPolicy: Always</span></div></div></div></div></div><p>This looks way longer than what we saw initially. Why is that?</p><p>First We have some labels. Labels are kubernetes way of uniquely identifying components. You can put labels of anything. In our case we put labels of the app and and version. (App and version are not key words)</p><p>In the template for our container wen can see we have the image name. The image is hosted in <a href="https://cloud.docker.com/u/moficodes/repository/list" target="_blank" rel="noopener noreferrer">docker hub</a>. </p><p><strong>Update Strategy</strong></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  strategy:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    rollingUpdate:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      maxSurge: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      maxUnavailable: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type: RollingUpdate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div></div></div><p>This block manages how our app updates. We have chose rolling update. Means the app will update incrementally. <code>maxSurge</code> defines how many extra pods we can spawn. <code>maxUnavailable</code> defines how many pods we are allowed to have less than spec.</p><p>So if our replica count is 3 during an update we may have 2-4 pods available with the current settings. For a crucial service you may want to have a higher <code>maxSurge</code> and a lower <code>maxUnavailable</code> count.</p><p><strong>Resource Quota</strong></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        resources:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          requests:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            cpu: &quot;250m&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            memory: &quot;128Mi&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          limits:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            cpu: &quot;250m&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            memory: &quot;128Mi&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div></div></div><p>This part is interesting and a great feature in kubernetes. We can set pod level resource constrains so one service does not end up starving others. This kind of constraints can be setup for namespaces as well. This is great for isolating userspace and managing resource per team or per service.</p><p><strong>Liveness Probe</strong></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        livenessProbe:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          httpGet:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            path: /health</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            port: 8080</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          initialDelaySeconds: 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          periodSeconds: 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div></div></div><p>Next we have something called a liveness probe. There is another probe called readiness probe. So liveness probe and readiness probe can look for some sign that the pod is alive or ready to serve request. In my app I setup a http liveness probe, k8s apiserver is making a http get request to the /health endpoint once every 3 second. In my app I have a random number generator and once about every 10 checks the health check fails and the app restart. </p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get po</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                           READY   STATUS    RESTARTS   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fact-deploy-576cd9b5c4-jhqd6   1/1     Running   2          39m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fact-deploy-576cd9b5c4-lzzpk   1/1     Running   0          39m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fact-deploy-576cd9b5c4-xmfg7   1/1     Running   1          39m</span></div></div></div></div></div><p>The restart happens randomly.</p><p>You can define liveness and readiness probes to be </p><ul><li>A Command</li><li>Http Request</li><li>TCP Probe</li></ul><p>Liveness and Readiness probes are super useful when you are waiting for some process to start before you start serving request or if a crucial component of your app goes away.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="check-the-app"></a>Check the App<a aria-hidden="true" tabindex="-1" class="hash-link" href="#check-the-app" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get svc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">factorial-service   ClusterIP      172.21.140.45    &lt;none&gt;        80/TCP         68m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fib-service         ClusterIP      172.21.24.38     &lt;none&gt;        80/TCP         68m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubernetes          ClusterIP      172.21.0.1       &lt;none&gt;        443/TCP        6d10h</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">prime-service       ClusterIP      172.21.164.123   &lt;none&gt;        80/TCP         68m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ui-service          LoadBalancer   172.21.80.239    xxx.xx.xx.x   80:32103/TCP   68m</span></div></div></div></div></div><p>You should see a external ip for the UI service. From your browser go to that url.</p><blockquote><p>Don&#x27;t use your phone or Safari browser. The UI for some reason does not look right there. Will fix this in a future version.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="rolling-our-own"></a>Rolling our OWN<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rolling-our-own" title="Direct link to heading">#</a></h2><p>We used the image I made and made public via docker hub. While it is easy, it is neither safe nor the best practice.</p><p>Let&#x27;s see how we can build our images and store it in a private registry.</p><p>I created a namespace <code>mofi-workshop</code> We will all build our images and push there. To avoid naming collision,</p><p>Use the following format</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mofi-workshop/&lt;Number of Your cluster&gt;-&lt;service-name&gt;:&lt;Tag&gt;</span></div></div></div></div></div><p>For example I have the cluster <code>app-to-k8s-workshop01</code> </p><p>So for fib service my image name becomes</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mofi-workshop/01-fib:0.0.1</span></div></div></div></div></div><p>Run the following.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ibmcloud cr login</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Logging in to &#x27;registry.ng.bluemix.net&#x27;...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Logged in to &#x27;registry.ng.bluemix.net&#x27;.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">IBM Cloud Container Registry is adopting new icr.io domain names to align with the rebranding of IBM Cloud for a better user experience. The existing bluemix.net domain names are deprecated, but you can continue to use them for the time being, as an unsupported date will be announced later. For more information about registry domain names, see https://cloud.ibm.com/docs/services/Registry?topic=registry-registry_overview#registry_regions_local</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Logging in to &#x27;us.icr.io&#x27;...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Logged in to &#x27;us.icr.io&#x27;.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">IBM Cloud Container Registry is adopting new icr.io domain names to align with the rebranding of IBM Cloud for a better user experience. The existing bluemix.net domain names are deprecated, but you can continue to use them for the time being, as an unsupported date will be announced later. For more information about registry domain names, see https://cloud.ibm.com/docs/services/Registry?topic=registry-registry_overview#registry_regions_local</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OK</span></div></div></div></div></div><p>From the root of the folder you need to go into each of the src folders.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd src/foxfram-fib</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ibmcloud cr build mofi-workshop/&lt;number&gt;-fib:0.0.1 .</span></div></div></div></div></div><p><code>ibmcloud cr build</code> command builds and pushes the image into the <code>mofi-workshop</code> namespace. </p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd ../foxfram-prime</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ibmcloud cr build mofi-workshop/&lt;number&gt;-prime:0.0.1 .</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd ../foxfram-factorial</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ibmcloud cr build mofi-workshop/&lt;number&gt;-factorial:0.0.1 .</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd ../foxfram-ui</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ibmcloud cr build mofi-workshop/&lt;number&gt;-ui:0.0.1 .</span></div></div></div></div></div><p>Once all the images have been built without any error. We can then go take a look if they are actually there.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ibmcloud cr images | grep mofi-workshop/&lt;number&gt;</span></div></div></div></div></div><p>Once you have all 4 images created, time  to update our deployments.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd k8s/all-deployment-svc</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">nano foxfram-fib-v1-deployment.yaml</span></div></div></div></div></div><p>change the following</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- image:  moficodes/foxfram-fib:0.0.5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- image:  us.icr.io/mofi-workshop/01-fib:0.0.1</span></div></div></div></div></div><p>Do similar changes for  </p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">foxfram-fact-v1-deployment.yaml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">foxfram-prime-v1-deployment.yaml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">foxfram-ui-v1-deployment.yaml</span></div></div></div></div></div><p>once all the files are updated with the new images.</p><p>Run</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f .</span></div></div></div></div></div><p>If everything goes well our app should be up and running.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/get-it-to-kubernetes-right.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/app-to-k8s/docs/get-it-to-kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Get It To Kubernetes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/app-to-k8s/docs/kubernetes-best-practices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kubernetes Best Practices »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#check-the-app" class="table-of-contents__link">Check the App</a></li><li><a href="#rolling-our-own" class="table-of-contents__link">Rolling our OWN</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/moficodes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://youtube.com/moficodes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/users/10272405/moficodes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="text--center"><div>@moficodes - 2020</div></div></div></footer></div>
<script src="/app-to-k8s/styles.c766f05e.js"></script>
<script src="/app-to-k8s/runtime~main.c7034982.js"></script>
<script src="/app-to-k8s/main.7f4e0a46.js"></script>
<script src="/app-to-k8s/1.6629a8c1.js"></script>
<script src="/app-to-k8s/2.011edda5.js"></script>
<script src="/app-to-k8s/36.45b256d1.js"></script>
<script src="/app-to-k8s/37.dbbad70c.js"></script>
<script src="/app-to-k8s/a1694d8d.506d67fe.js"></script>
<script src="/app-to-k8s/17896441.18b63303.js"></script>
<script src="/app-to-k8s/0b8842b4.0d17634d.js"></script>
</body>
</html>