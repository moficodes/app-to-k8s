(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{103:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(2),r=n(6),o=(n(0),n(137)),i={id:"get-it-to-kubernetes",title:"Get It To Kubernetes",sidebar_label:"Get It To Kubernetes"},s={id:"get-it-to-kubernetes",isDocsHomePage:!1,title:"Get It To Kubernetes",description:"Kubernetes has many things",source:"@site/docs/get-it-to-kubernetes.md",permalink:"/docs/get-it-to-kubernetes",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/get-it-to-kubernetes.md",sidebar_label:"Get It To Kubernetes",sidebar:"docs",previous:{title:"Containerize",permalink:"/docs/containerize"},next:{title:"Get It To Kubernetes Right",permalink:"/docs/get-it-to-kubernetes-right"}},c=[{value:"Pods",id:"pods",children:[]},{value:"Deployment",id:"deployment",children:[]},{value:"Service",id:"service",children:[]}],l={rightToc:c};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Kubernetes has many things"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"NAME                              SHORTNAMES   APIGROUP                       NAMESPACED   KIND\nbindings                                                                      true         Binding\ncomponentstatuses                 cs                                          false        ComponentStatus\nconfigmaps                        cm                                          true         ConfigMap\nendpoints                         ep                                          true         Endpoints\nevents                            ev                                          true         Event\nlimitranges                       limits                                      true         LimitRange\nnamespaces                        ns                                          false        Namespace\nnodes                             no                                          false        Node\npersistentvolumeclaims            pvc                                         true         PersistentVolumeClaim\npersistentvolumes                 pv                                          false        PersistentVolume\npods                              po                                          true         Pod\npodtemplates                                                                  true         PodTemplate\nreplicationcontrollers            rc                                          true         ReplicationController\nresourcequotas                    quota                                       true         ResourceQuota\nsecrets                                                                       true         Secret\nserviceaccounts                   sa                                          true         ServiceAccount\nservices                          svc                                         true         Service\ninitializerconfigurations                      admissionregistration.k8s.io   false        InitializerConfiguration\nmutatingwebhookconfigurations                  admissionregistration.k8s.io   false        MutatingWebhookConfiguration\nvalidatingwebhookconfigurations                admissionregistration.k8s.io   false        ValidatingWebhookConfiguration\ncustomresourcedefinitions         crd,crds     apiextensions.k8s.io           false        CustomResourceDefinition\napiservices                                    apiregistration.k8s.io         false        APIService\ncontrollerrevisions                            apps                           true         ControllerRevision\ndaemonsets                        ds           apps                           true         DaemonSet\ndeployments                       deploy       apps                           true         Deployment\nreplicasets                       rs           apps                           true         ReplicaSet\nstatefulsets                      sts          apps                           true         StatefulSet\nmeshpolicies                                   authentication.istio.io        false        MeshPolicy\npolicies                                       authentication.istio.io        true         Policy\ntokenreviews                                   authentication.k8s.io          false        TokenReview\nlocalsubjectaccessreviews                      authorization.k8s.io           true         LocalSubjectAccessReview\nselfsubjectaccessreviews                       authorization.k8s.io           false        SelfSubjectAccessReview\nselfsubjectrulesreviews                        authorization.k8s.io           false        SelfSubjectRulesReview\nsubjectaccessreviews                           authorization.k8s.io           false        SubjectAccessReview\nhorizontalpodautoscalers          hpa          autoscaling                    true         HorizontalPodAutoscaler\ncronjobs                          cj           batch                          true         CronJob\njobs                                           batch                          true         Job\ncertificatesigningrequests        csr          certificates.k8s.io            false        CertificateSigningRequest\ncertificates                      cert,certs   certmanager.k8s.io             true         Certificate\nchallenges                                     certmanager.k8s.io             true         Challenge\nclusterissuers                                 certmanager.k8s.io             false        ClusterIssuer\nissuers                                        certmanager.k8s.io             true         Issuer\norders                                         certmanager.k8s.io             true         Order\nleases                                         coordination.k8s.io            true         Lease\nevents                            ev           events.k8s.io                  true         Event\ndaemonsets                        ds           extensions                     true         DaemonSet\ndeployments                       deploy       extensions                     true         Deployment\ningresses                         ing          extensions                     true         Ingress\nnetworkpolicies                   netpol       extensions                     true         NetworkPolicy\npodsecuritypolicies               psp          extensions                     false        PodSecurityPolicy\nreplicasets                       rs           extensions                     true         ReplicaSet\nnodes                                          metrics.k8s.io                 false        NodeMetrics\npods                                           metrics.k8s.io                 true         PodMetrics\nnetworkpolicies                   netpol       networking.k8s.io              true         NetworkPolicy\npoddisruptionbudgets              pdb          policy                         true         PodDisruptionBudget\npodsecuritypolicies               psp          policy                         false        PodSecurityPolicy\nclusterrolebindings                            rbac.authorization.k8s.io      false        ClusterRoleBinding\nclusterroles                                   rbac.authorization.k8s.io      false        ClusterRole\nrolebindings                                   rbac.authorization.k8s.io      true         RoleBinding\nroles                                          rbac.authorization.k8s.io      true         Role\npriorityclasses                   pc           scheduling.k8s.io              false        PriorityClass\nstorageclasses                    sc           storage.k8s.io                 false        StorageClass\nvolumeattachments                              storage.k8s.io                 false        VolumeAttachment\n")),Object(o.b)("p",null,"To get our app to run on K8S we don't need to know all of them. At the bare minimum we need to deal with 3 of these. Pods, Deployments and Services."),Object(o.b)("h3",{id:"pods"},"Pods"),Object(o.b)("p",null,"Pods is the smallest unit in kubernetes. Each pod has to have atleast one container. But can have more. In some advanced kubernetes setup there are more that one container. Sidecar container, init container etc. "),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-example\nspec:\n  containers:\n  - name: ubuntu\n    image: ubuntu:trusty\n")),Object(o.b)("p",null,"This is the most minimal pod you can create. "),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:"left"}),"Field"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:"left"}),"Description"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(o.b)("inlineCode",{parentName:"td"},"apiVersion")," string"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: ",Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://git.k8s.io/community/contributors/devel/api-conventions.md%5C#resources"}),"https://git.k8s.io/community/contributors/devel/api-conventions.md\\#resources"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(o.b)("inlineCode",{parentName:"td"},"kind")," string"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: ",Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://git.k8s.io/community/contributors/devel/api-conventions.md%5C#types-kinds"}),"https://git.k8s.io/community/contributors/devel/api-conventions.md\\#types-kinds"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(o.b)("inlineCode",{parentName:"td"},"metadata")," ",Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#objectmeta-v1-meta"}),"ObjectMeta")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"Standard object's metadata. More info: ",Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://git.k8s.io/community/contributors/devel/api-conventions.md%5C#metadata"}),"https://git.k8s.io/community/contributors/devel/api-conventions.md\\#metadata"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(o.b)("inlineCode",{parentName:"td"},"spec")," ",Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#podspec-v1-core"}),"PodSpec")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"Specification of the desired behavior of the pod. More info: ",Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://git.k8s.io/community/contributors/devel/api-conventions.md%5C#spec-and-status"}),"https://git.k8s.io/community/contributors/devel/api-conventions.md\\#spec-and-status"))))),Object(o.b)("p",null,"In k8s we should never create a pod this way. Because pods by itself can not self restart or scale if needed."),Object(o.b)("p",null,"For that we use a replicaset or deployment."),Object(o.b)("h3",{id:"deployment"},"Deployment"),Object(o.b)("p",null,"A ",Object(o.b)("em",{parentName:"p"},"Deployment")," controller provides declarative updates for ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod/"}),"Pods")," and ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/"}),"ReplicaSets"),"."),Object(o.b)("p",null,"You describe a ",Object(o.b)("em",{parentName:"p"},"desired state")," in a Deployment object, and the Deployment controller changes the actual state to the desired state at a controlled rate. You can define Deployments to create new ReplicaSets, or to remove existing Deployments and adopt all their resources with new Deployments."),Object(o.b)("p",null,"The quick and dirty way to create a deployment is to use the run command."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"kubectl run nginx --image=nginx:1.10 --replicas=3\n")),Object(o.b)("p",null,"But this is not preferred because its not reproducible. We should use a yaml file and check it in version control. "),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  # Unique key of the Deployment instance\n  name: deployment-example\nspec:\n  # 3 Pods should exist at all times.\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        # Apply this label to pods and default\n        # the Deployment label selector to this value\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        # Run this image\n        image: nginx:1.10\n")),Object(o.b)("p",null,"The pod spec is embedded in the deployment under template."),Object(o.b)("p",null,"Finally we need a way to make the app available to the world. We use a service for that."),Object(o.b)("h3",{id:"service"},"Service"),Object(o.b)("p",null,"Kubernetes ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod/"}),Object(o.b)("inlineCode",{parentName:"a"},"Pods"))," are mortal. They are born and when they die, they are not resurrected. ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/"}),Object(o.b)("inlineCode",{parentName:"a"},"ReplicaSets"))," in particular create and destroy ",Object(o.b)("inlineCode",{parentName:"p"},"Pods")," dynamically ","(","e.g. when scaling out or in",")",". While each ",Object(o.b)("inlineCode",{parentName:"p"},"Pod")," gets its own IP address, even those IP addresses cannot be relied upon to be stable over time. This leads to a problem: if some set of ",Object(o.b)("inlineCode",{parentName:"p"},"Pods")," ","(","let\u2019s call them backends",")"," provides functionality to other ",Object(o.b)("inlineCode",{parentName:"p"},"Pods")," ","(","let\u2019s call them frontends",")"," inside the Kubernetes cluster, how do those frontends find out and keep track of which backends are in that set?"),Object(o.b)("p",null,"Enter ",Object(o.b)("inlineCode",{parentName:"p"},"Services"),"."),Object(o.b)("p",null,"A Kubernetes ",Object(o.b)("inlineCode",{parentName:"p"},"Service")," is an abstraction which defines a logical set of ",Object(o.b)("inlineCode",{parentName:"p"},"Pods")," and a policy by which to access them - sometimes called a micro-service. The set of ",Object(o.b)("inlineCode",{parentName:"p"},"Pods")," targeted by a ",Object(o.b)("inlineCode",{parentName:"p"},"Service")," is ","(","usually",")"," determined by a ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors"}),Object(o.b)("inlineCode",{parentName:"a"},"Label Selector"))," ","(","see below for why you might want a ",Object(o.b)("inlineCode",{parentName:"p"},"Service")," without a selector",")","."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"kind: Service\napiVersion: v1\nmetadata:\n  # Unique key of the Service instance\n  name: service-example\nspec:\n  ports:\n    # Accept traffic sent to port 80\n    - name: http\n      port: 80\n      targetPort: 80\n  selector:\n    # this label selector\n    app: nginx\n")),Object(o.b)("p",null,"There are few types of services out there."),Object(o.b)("p",null,"For some parts of your application ","(","e.g. frontends",")"," you may want to expose a Service onto an external ","(","outside of your cluster",")"," IP address."),Object(o.b)("p",null,"Kubernetes ",Object(o.b)("inlineCode",{parentName:"p"},"ServiceTypes")," allow you to specify what kind of service you want. The default is ",Object(o.b)("inlineCode",{parentName:"p"},"ClusterIP"),"."),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"Type")," values and their behaviors are:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"ClusterIP"),": Exposes the service on a cluster-internal IP. Choosing this value makes the service only reachable from within the cluster. This is the default ",Object(o.b)("inlineCode",{parentName:"li"},"ServiceType"),"."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://kubernetes.io/docs/concepts/services-networking/service/#nodeport"}),Object(o.b)("inlineCode",{parentName:"a"},"NodePort")),": Exposes the service on each Node\u2019s IP at a static port ","(","the ",Object(o.b)("inlineCode",{parentName:"li"},"NodePort"),")",". A ",Object(o.b)("inlineCode",{parentName:"li"},"ClusterIP")," service, to which the ",Object(o.b)("inlineCode",{parentName:"li"},"NodePort")," service will route, is automatically created. You\u2019ll be able to contact the ",Object(o.b)("inlineCode",{parentName:"li"},"NodePort")," service, from outside the cluster, by requesting ",Object(o.b)("inlineCode",{parentName:"li"},"<NodeIP>:<NodePort>"),"."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer"}),Object(o.b)("inlineCode",{parentName:"a"},"LoadBalancer")),": Exposes the service externally using a cloud provider\u2019s load balancer. ",Object(o.b)("inlineCode",{parentName:"li"},"NodePort")," and ",Object(o.b)("inlineCode",{parentName:"li"},"ClusterIP")," services, to which the external load balancer will route, are automatically created."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://kubernetes.io/docs/concepts/services-networking/service/#externalname"}),Object(o.b)("inlineCode",{parentName:"a"},"ExternalName")),": Maps the service to the contents of the ",Object(o.b)("inlineCode",{parentName:"li"},"externalName")," field ","(","e.g. ",Object(o.b)("inlineCode",{parentName:"li"},"foo.bar.example.com"),")",", by returning a ",Object(o.b)("inlineCode",{parentName:"li"},"CNAME")," record with its value. No proxying of any kind is set up. This requires version 1.7 or higher of ",Object(o.b)("inlineCode",{parentName:"li"},"kube-dns"),".")),Object(o.b)("p",null,"ClusterIP is cluster internal. We will see both ClusterIP and LoadBalancer in depth in a second."))}p.isMDXComponent=!0},137:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),b=p(n),u=a,m=b["".concat(i,".").concat(u)]||b[u]||d[u]||o;return n?r.a.createElement(m,s(s({ref:t},l),{},{components:n})):r.a.createElement(m,s({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);